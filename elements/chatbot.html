<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mara Chatbot (Typing Effect)</title>
<style>
  body {
    font-family: "Segoe UI", sans-serif;
    background: #f7f9fb;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    height: 100vh;
  }
  #chat {
    flex: 1;
    overflow-y: auto;
    padding: 15px;
    display: flex;
    flex-direction: column;
  }
  .msg {
    margin: 8px 0;
    padding: 10px 15px;
    border-radius: 15px;
    max-width: 80%;
    line-height: 1.4;
    white-space: pre-wrap;
  }
  .bot {
    background: #e7f1ff;
    align-self: flex-start;
  }
  .user {
    background: #545454;
    color: white;
    align-self: flex-end;
  }
  #inputArea {
    display: flex;
    padding: 10px;
    background: #fff;
    border-top: 1px solid #ccc;
  }
  #userInput {
    flex: 1;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 5px;
  }
  button {
    margin-left: 8px;
    padding: 10px 15px;
    border: none;
    background: #545454;
    color: #fff;
    border-radius: 5px;
    cursor: pointer;
  }
</style>
</head>
<body>
<div id="chat"></div>
<div id="inputArea">
  <input type="text" id="userInput" placeholder="Enter number..." autofocus>
  <button onclick="sendMsg()">Send</button>
</div>

<script>
// ‚öôÔ∏è Auto-generate compact 20√ó20√ó20 structure
function generateMenu(level = 1, prefix = "") {
  const menu = {
    title: (prefix === "" ? "üè† MAIN MENU" : `üìã Option ${prefix} Menu`),
    options: {},
    branches: {}
  };

  for (let i = 1; i <= 20; i++) {
    const label = prefix ? `${prefix}.${i}` : `${i}`;
    menu.options[i] = `Option ${label}`;
    if (level < 3) {
      menu.branches[i] = generateMenu(level + 1, label);
    } else {
      menu.branches[i] = {
        title: `üìò Option ${label}`,
        message: `Details for Option ${label}\n\n99. Back\n0. Main Menu`
      };
    }
  }
  return menu;
}

// üß† Create nested menu tree
const menu = { main: generateMenu() };

// üí¨ Chat Logic
let currentMenu = menu.main;
let menuStack = [menu.main];

function addMessage(text, sender, typing = false) {
  const chat = document.getElementById("chat");
  const msg = document.createElement("div");
  msg.classList.add("msg", sender);
  chat.appendChild(msg);
  chat.scrollTop = chat.scrollHeight;

  if (sender === "bot" && typing) {
    typeEffect(msg, text);
  } else {
    msg.textContent = text;
  }
}

function typeEffect(element, text) {
  let index = 0;
  const speed = 10; // typing speed (lower = faster)
  const typing = setInterval(() => {
    element.textContent += text.charAt(index);
    index++;
    element.scrollIntoView({ behavior: "smooth", block: "end" });
    if (index >= text.length) clearInterval(typing);
  }, speed);
}

function showMenu(menuNode) {
  let menuText = `üìã ${menuNode.title}\n\n`;
  for (const [key, value] of Object.entries(menuNode.options)) {
    menuText += `${key}. ${value}\n`;
  }
  menuText += `\n99. Back\n0. Main Menu`;
  addMessage(menuText, "bot", true);
}

function sendMsg() {
  const input = document.getElementById("userInput");
  const userText = input.value.trim();
  if (!userText) return;
  addMessage(userText, "user");
  input.value = "";

  const code = userText.toLowerCase();

  if (code === "0") {
    currentMenu = menu.main;
    menuStack = [menu.main];
    showMenu(currentMenu);
    return;
  }

  if (code === "99") {
    if (menuStack.length > 1) {
      menuStack.pop();
      currentMenu = menuStack[menuStack.length - 1];
      showMenu(currentMenu);
    } else {
      showMenu(menu.main);
    }
    return;
  }

  if (currentMenu.branches && currentMenu.branches[code]) {
    currentMenu = currentMenu.branches[code];
    menuStack.push(currentMenu);
    if (currentMenu.message) {
      addMessage(currentMenu.message, "bot", true);
    } else {
      showMenu(currentMenu);
    }
  } else {
    addMessage("‚ùå Invalid choice. Please try again.", "bot", true);
    showMenu(currentMenu);
  }
}

window.onload = () => showMenu(menu.main);
</script>
</body>
</html>
